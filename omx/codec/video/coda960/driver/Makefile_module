########################################################################
# Set Install Directory
ifndef	INSTALL_DIR
INSTALL_DIR := ./__install
endif

########################################################################
# Module Definition & Version Management
DEVICE_NAME := NXP4330
MOD_BASE := vpu960
MOD_NAME := nxvpu

BUILD_NUMBER_FILE = build_number_$(MOD_NAME)
BUILD_INFO_FILE = include/build_info_$(MOD_NAME).h
MAJOR = 0
MINOR = 1

######################################################################
# Configuration Target
TARGET			= nxvpudrv
obj-m			:= $(TARGET).o 

# android kernel
KDIR			:= /home/ray/devel/android/kernel-svn
STRIP_CMD		= arm-cortex_a9-linux-gnueabi-strip

######################################################################
# Source Cods
$(TARGET)-objs		:=

# Driver Main
$(TARGET)-objs		+= linux/linux_vpu_drv.o

# OS APIS
$(TARGET)-objs		+= osapi/drv_osapi_linux.o

# VPU Control Sources
$(TARGET)-objs		+= src/vpu_hw_interface.o
$(TARGET)-objs		+= src/nx_vpu_api.o
$(TARGET)-objs		+= src/nx_vpu_gdi.o


################################################################################
#	Build options for board type
################################################################################
PWD     := $(shell pwd)
KBUILD_CFLAGS += -I./include
KBUILD_CFLAGS += -I../include
KBUILD_CFLAGS += -I./firmware


######################################################################
# Build
#default: UPDATE_BUILD_NUMBER
#	$(MAKE) -C $(KDIR) M=$(PWD) modules

#default:
#	$(MAKE) -C $(KDIR) M=$(PWD) modules

clean:
	@find . -type f \( -name '*.ko' -o -name '*.mod.*'	\
				    -o -name '*.o' -o -name '.*.cmd'		\
				    -o -name '*.order' -o -name '*.symvers'		\
					-o -name '*.' \) -print | xargs rm -f

UPDATE_BUILD_NUMBER :
	@echo $$(($$(cat $(BUILD_NUMBER_FILE).txt) + 1)) > $(BUILD_NUMBER_FILE).txt
	@echo
	@echo "================================================================================"
	@echo
	@echo "Update Build Number: $(MOD_NAME) version $(MAJOR).$(MINOR).$$(cat $(BUILD_NUMBER_FILE).txt) (built by $$(whoami) at $$(date) )"
	@echo
	@echo "================================================================================"
	@echo
	@echo "#define	DIAG_MODULE_NAME	$(MOD_NAME)	//	Module Name" > $(BUILD_INFO_FILE)
	@echo "#define	$(MOD_BASE)_DEVICE	\"$(DEVICE_NAME)\"	//	Device Name" >> $(BUILD_INFO_FILE)
	@echo "#define	$(MOD_BASE)_MAJOR	$(MAJOR)	//	Major Version Number" >> $(BUILD_INFO_FILE)
	@echo "#define	$(MOD_BASE)_MINOR	$(MINOR)	//	Minor Version Number" >> $(BUILD_INFO_FILE)
	@echo "#define	$(MOD_BASE)_BUILD	$$(cat $(BUILD_NUMBER_FILE).txt)	//	Build Number" >> $(BUILD_INFO_FILE)
	@echo "#define	$(MOD_BASE)_DATE	__DATE__" //	Build Date >> $(BUILD_INFO_FILE)
	@echo "#define	$(MOD_BASE)_TIME	__TIME__" //	Build Time >> $(BUILD_INFO_FILE)
	@echo "#define	$(MOD_BASE)_USER	\"$$(whoami)\""	//	Build User >> $(BUILD_INFO_FILE)
