# -----------------------------------------------------------------------------
#  This confidential and proprietary software may be used only as authorized
#  by a licensing agreement from ARM Limited.
#          (C) COPYRIGHT 2010-2012 ARM Limited, ALL RIGHTS RESERVED
#  The entire notice above must be reproduced on all authorized copies and
#  copies may only be made to the extent permitted by a licensing agreement
#  from ARM Limited.
# -----------------------------------------------------------------------------

import os

Import( "env", "rBuildArch", "rBuildOS", "rBuildWindowSystem" )

# All modules that use the tpi are going to need to use the standard rt and pthread libraries.
env.AppendUnique(
	LIBS=["rt", "pthread", "m"]
)

# Everything else should be the same on all OSs.

objects = []

tpi_os_objs = env.SharedObject( ["mali_tpi_" + rBuildOS + ".c"], CPPPATH=[ '$CPPPATH', '#tpi' ] )
objects.append( 'tpi_os_objs' )


if rBuildWindowSystem != '' and rBuildWindowSystem != '0':
	# Build tpi_egl library as well.

	egl_src = [ ]

	# Set name of egl source file
	egl_src.append( os.path.join( "mali_tpi_" + rBuildOS + "_egl_" + rBuildWindowSystem + ".c" ) )

	if rBuildWindowSystem == "dummy"  or  rBuildWindowSystem == "fbdev":
		egl_src.append( os.path.join( "mali_tpi_" + rBuildOS + "_egl_common.c" ) )

	tpi_egl_os_objs = env.SharedObject( egl_src, CPPPATH=[ '$CPPPATH', '#tpi' ] )
	objects.append( 'tpi_egl_os_objs' )


Return( objects )
